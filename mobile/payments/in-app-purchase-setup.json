{
  "in_app_purchase_configuration": {
    "overview": "Complete in-app purchase setup for TailTracker iOS and Android with RevenueCat integration",
    "monetization_strategy": {
      "model": "Freemium with Premium Subscription",
      "free_features": [
        "Single pet profile",
        "Basic location tracking",
        "7 days location history",
        "Basic safe zones (2 zones)",
        "Standard notifications"
      ],
      "premium_features": [
        "Unlimited pet profiles",
        "Real-time location tracking",
        "30 days location history",
        "Unlimited safe zones",
        "Advanced analytics",
        "Priority customer support",
        "Family sharing (up to 6 members)",
        "Export data and reports",
        "Offline maps",
        "Custom notification sounds"
      ]
    },
    "subscription_products": {
      "monthly_premium": {
        "product_id": "premium_monthly",
        "price_tier": "Tier 5",
        "local_price": "$4.99",
        "billing_period": "P1M",
        "trial_period": "P7D",
        "grace_period": "P3D",
        "description": "Monthly premium subscription with 7-day free trial",
        "features": "All premium features included",
        "auto_renewable": true,
        "family_shareable": true
      },
      "yearly_premium": {
        "product_id": "premium_yearly", 
        "price_tier": "Tier 30",
        "local_price": "$29.99",
        "billing_period": "P1Y",
        "trial_period": "P7D",
        "grace_period": "P3D",
        "description": "Yearly premium subscription - Save 50%",
        "features": "All premium features included",
        "auto_renewable": true,
        "family_shareable": true,
        "savings": "50% compared to monthly billing"
      }
    },
    "one_time_purchases": {
      "lifetime_premium": {
        "product_id": "lifetime_premium",
        "price_tier": "Tier 60",
        "local_price": "$99.99",
        "description": "One-time purchase for lifetime premium access",
        "features": "All premium features forever",
        "consumable": false,
        "family_shareable": true
      }
    },
    "platform_configuration": {
      "ios_app_store": {
        "subscription_group": {
          "reference_name": "TailTracker Premium Subscriptions",
          "subscription_group_id": "premium_subscriptions"
        },
        "products": [
          {
            "product_id": "com.tailtracker.app.premium.monthly",
            "reference_name": "Premium Monthly",
            "type": "Auto-Renewable Subscription",
            "subscription_duration": "1 Month",
            "price": "$4.99",
            "family_shareable": true,
            "localizations": {
              "en-US": {
                "display_name": "Premium Monthly",
                "description": "Unlock all premium features with unlimited pet tracking, advanced analytics, and priority support. Auto-renews monthly."
              },
              "es": {
                "display_name": "Premium Mensual",
                "description": "Desbloquea todas las funciones premium con seguimiento ilimitado de mascotas, análisis avanzados y soporte prioritario."
              }
            }
          },
          {
            "product_id": "com.tailtracker.app.premium.yearly",
            "reference_name": "Premium Yearly",
            "type": "Auto-Renewable Subscription", 
            "subscription_duration": "1 Year",
            "price": "$29.99",
            "family_shareable": true,
            "localizations": {
              "en-US": {
                "display_name": "Premium Yearly",
                "description": "Best value! Get all premium features for a full year. Save 50% compared to monthly billing. Auto-renews yearly."
              },
              "es": {
                "display_name": "Premium Anual", 
                "description": "¡Mejor valor! Obtén todas las funciones premium por un año completo. Ahorra 50% comparado con la facturación mensual."
              }
            }
          }
        ]
      },
      "google_play_store": {
        "base_plan_configuration": {
          "subscription_id": "premium_subscription",
          "product_id": "premium",
          "base_plans": [
            {
              "base_plan_id": "monthly",
              "billing_period": "P1M",
              "price": "$4.99",
              "auto_renewing": true,
              "proration_mode": "IMMEDIATE_WITH_TIME_PRORATION"
            },
            {
              "base_plan_id": "yearly",
              "billing_period": "P1Y", 
              "price": "$29.99",
              "auto_renewing": true,
              "proration_mode": "IMMEDIATE_WITH_TIME_PRORATION"
            }
          ],
          "offers": [
            {
              "offer_id": "free_trial",
              "base_plan_id": "monthly",
              "phases": [
                {
                  "duration": "P7D",
                  "price": "$0.00",
                  "billing_period": "P7D",
                  "billing_cycles": 1
                },
                {
                  "duration": "P1M",
                  "price": "$4.99", 
                  "billing_period": "P1M",
                  "billing_cycles": 0
                }
              ]
            }
          ]
        }
      }
    },
    "revenuecat_configuration": {
      "setup": {
        "api_keys": {
          "apple": "${REVENUECAT_APPLE_API_KEY}",
          "google": "${REVENUECAT_GOOGLE_API_KEY}"
        },
        "project_settings": {
          "app_user_id": "Use authenticated user ID from Supabase",
          "anonymous_id_generation": false,
          "restore_behavior": "ALWAYS_USE_CACHE",
          "should_show_in_app_messages_automatically": true
        }
      },
      "entitlements": {
        "premium": {
          "description": "Premium features access",
          "products": [
            "premium_monthly",
            "premium_yearly",
            "lifetime_premium"
          ]
        }
      },
      "offerings": {
        "default": {
          "description": "Main subscription offering",
          "packages": [
            {
              "identifier": "monthly",
              "type": "MONTHLY",
              "product": "premium_monthly"
            },
            {
              "identifier": "yearly",
              "type": "ANNUAL",
              "product": "premium_yearly"
            },
            {
              "identifier": "lifetime",
              "type": "LIFETIME",
              "product": "lifetime_premium"
            }
          ]
        }
      }
    },
    "implementation_code": {
      "initialization": "// RevenueCat initialization\nimport Purchases from 'react-native-purchases';\n\nconst initializePurchases = async () => {\n  try {\n    if (Platform.OS === 'ios') {\n      await Purchases.configure({\n        apiKey: process.env.REVENUECAT_APPLE_API_KEY,\n      });\n    } else {\n      await Purchases.configure({\n        apiKey: process.env.REVENUECAT_GOOGLE_API_KEY,\n      });\n    }\n    \n    // Set user ID from authentication\n    const userId = await getAuthenticatedUserId();\n    if (userId) {\n      await Purchases.logIn(userId);\n    }\n  } catch (error) {\n    console.error('Failed to initialize purchases:', error);\n  }\n};",
      "subscription_check": "// Check subscription status\nconst checkSubscriptionStatus = async () => {\n  try {\n    const purchaserInfo = await Purchases.getCustomerInfo();\n    const isSubscribed = purchaserInfo.entitlements.active.premium !== undefined;\n    const expirationDate = purchaserInfo.entitlements.active.premium?.expirationDate;\n    \n    return {\n      isSubscribed,\n      expirationDate,\n      willRenew: purchaserInfo.entitlements.active.premium?.willRenew,\n      isInIntroOfferPeriod: purchaserInfo.entitlements.active.premium?.isInIntroOfferPeriod,\n    };\n  } catch (error) {\n    console.error('Failed to check subscription status:', error);\n    return { isSubscribed: false };\n  }\n};",
      "purchase_flow": "// Handle subscription purchase\nconst purchaseSubscription = async (packageIdentifier) => {\n  try {\n    const offerings = await Purchases.getOfferings();\n    const targetPackage = offerings.current?.availablePackages.find(\n      pkg => pkg.identifier === packageIdentifier\n    );\n    \n    if (!targetPackage) {\n      throw new Error('Package not found');\n    }\n    \n    const purchaserInfo = await Purchases.purchasePackage(targetPackage);\n    \n    if (purchaserInfo.entitlements.active.premium) {\n      // Subscription successful\n      await syncPremiumFeatures();\n      showSuccessMessage('Welcome to TailTracker Premium!');\n      return true;\n    }\n  } catch (error) {\n    if (error.userCancelled) {\n      console.log('User cancelled purchase');\n    } else {\n      console.error('Purchase failed:', error);\n      showErrorMessage('Purchase failed. Please try again.');\n    }\n    return false;\n  }\n};",
      "restore_purchases": "// Restore previous purchases\nconst restorePurchases = async () => {\n  try {\n    const purchaserInfo = await Purchases.restorePurchases();\n    \n    if (purchaserInfo.entitlements.active.premium) {\n      await syncPremiumFeatures();\n      showSuccessMessage('Premium features restored!');\n      return true;\n    } else {\n      showInfoMessage('No active subscriptions found.');\n      return false;\n    }\n  } catch (error) {\n    console.error('Failed to restore purchases:', error);\n    showErrorMessage('Failed to restore purchases.');\n    return false;\n  }\n};"
    },
    "testing_configuration": {
      "ios_testing": {
        "testflight": {
          "sandbox_environment": true,
          "test_accounts": [
            {
              "email": "test.premium@tailtracker.com",
              "country": "US",
              "subscription_type": "monthly",
              "trial_status": "active"
            },
            {
              "email": "test.yearly@tailtracker.com", 
              "country": "US",
              "subscription_type": "yearly",
              "trial_status": "expired"
            }
          ],
          "testing_scenarios": [
            "New subscription with trial",
            "Subscription renewal",
            "Subscription cancellation",
            "Restore purchases",
            "Upgrade/downgrade plans",
            "Family sharing activation"
          ]
        },
        "app_store_connect": {
          "sandbox_testers": "Use App Store Connect sandbox accounts",
          "subscription_testing": "Enable subscription testing in Sandbox"
        }
      },
      "android_testing": {
        "google_play_console": {
          "test_tracks": ["Internal testing", "Closed testing"],
          "license_testing": [
            "test.android.premium@gmail.com",
            "test.android.yearly@gmail.com"
          ],
          "testing_scenarios": [
            "Google Play Billing integration",
            "Subscription purchase flow",
            "Subscription management",
            "Proration handling",
            "Grace period testing"
          ]
        }
      },
      "cross_platform_testing": [
        "Account sync between platforms",
        "Subscription status consistency",
        "Feature unlock synchronization",
        "Receipt validation",
        "Error handling scenarios"
      ]
    },
    "user_experience": {
      "paywall_design": {
        "entry_points": [
          "Premium feature gate",
          "Settings > Premium",
          "Onboarding flow",
          "Feature limit reached"
        ],
        "design_principles": [
          "Clear value proposition",
          "Transparent pricing",
          "Easy cancellation info",
          "Social proof elements",
          "Risk-free trial emphasis"
        ],
        "content_strategy": {
          "headline": "Unlock Premium Pet Safety",
          "benefits": [
            "Track unlimited pets simultaneously",
            "30 days of location history vs. 7 days",
            "Advanced safe zone analytics",
            "Priority 24/7 customer support",
            "Family sharing for up to 6 members",
            "Export and backup all your data"
          ],
          "trial_messaging": "Start your 7-day free trial. Cancel anytime.",
          "pricing_display": "$4.99/month after trial"
        }
      },
      "subscription_management": {
        "in_app_settings": [
          "View current subscription status",
          "See renewal date and pricing",
          "Manage family sharing",
          "Download usage reports",
          "Contact premium support"
        ],
        "platform_management": {
          "ios": "Manage subscription in iOS Settings > Apple ID > Subscriptions",
          "android": "Manage subscription in Google Play Store > Subscriptions"
        }
      },
      "feature_gating": {
        "soft_gates": [
          "Feature preview with upgrade prompt",
          "Limited usage with counter",
          "Educational tooltips about premium benefits"
        ],
        "hard_gates": [
          "Premium-only screens",
          "Advanced settings sections",
          "Export functionality"
        ]
      }
    },
    "compliance_requirements": {
      "app_store_guidelines": {
        "section_3_1_1": "In-App Purchase implementation",
        "requirements": [
          "Use only Apple's payment system",
          "Clearly describe subscription terms",
          "Provide restore purchases functionality",
          "Handle subscription status changes",
          "Comply with auto-renewable subscription guidelines"
        ]
      },
      "google_play_policies": {
        "billing_policy": "Google Play Billing integration",
        "requirements": [
          "Use Google Play Billing for digital goods",
          "Provide clear subscription information",
          "Handle subscription lifecycle properly",
          "Comply with subscription cancellation policies",
          "Follow promotional offer guidelines"
        ]
      },
      "legal_requirements": [
        "Clear terms of service",
        "Transparent pricing display",
        "Easy cancellation process",
        "Refund policy disclosure",
        "Auto-renewal terms explanation",
        "Free trial conditions"
      ]
    },
    "analytics_and_monitoring": {
      "key_metrics": [
        "Conversion rate (trial to paid)",
        "Churn rate by subscription type",
        "Customer lifetime value",
        "Revenue per user",
        "Feature usage by tier",
        "Payment failure rates"
      ],
      "tracking_implementation": {
        "revenuecat_analytics": "Built-in subscription analytics",
        "custom_events": [
          "Paywall viewed",
          "Trial started",
          "Subscription purchased",
          "Feature upgrade prompted",
          "Subscription cancelled"
        ],
        "integration": "Mixpanel, Google Analytics, Firebase"
      }
    },
    "customer_support": {
      "subscription_support": [
        "Billing questions and disputes",
        "Trial and cancellation assistance",
        "Feature unlock troubleshooting",
        "Account synchronization issues",
        "Refund request processing"
      ],
      "support_channels": [
        "In-app premium support chat",
        "Email: premium@tailtracker.com",
        "Knowledge base: help.tailtracker.com",
        "Video tutorials for subscription management"
      ]
    }
  }
}